/*
 * stm32f303re.h
 *
 *  Created on: Jul 25, 2022
 *      Author: Alie Eldeen
 */

#ifndef INC_STM32F303RE_H_
#define INC_STM32F303RE_H_
#include <stdint.h>

/*
 * Processor specific Details
 */
// Arm Cortex M4 ISERx Registers
#define NVIC_ISER0				((volatile uint32_t*)0xE000E100)
#define NVIC_ISER1				((volatile uint32_t*)0xE000E104)
#define NVIC_ISER2				((volatile uint32_t*)0xE000E108)
#define NVIC_ISER3				((volatile uint32_t*)0xE000E10C)

// Arm Cortex M4 ICERx Registers
#define NVIC_ICER0				((volatile uint32_t*)0XE000E180)
#define NVIC_ICER1				((volatile uint32_t*)0XE000E184)
#define NVIC_ICER2				((volatile uint32_t*)0XE000E188)
#define NVIC_ICER3				((volatile uint32_t*)0XE000E18C)

// Arm Cortex M4 Periorty Register

#define NVIC_PR_BASE_ADDR		((volatile uint32_t*)0xE000E404)

#define NO_PR_BITS_IMPLEMENTED 	4
// step 1 define different memories in MCU
#define FLASH_BASEADDR		0x08000000U //Flash base Address
#define SRAM1_BASEADDR		0x20000000U //SRAM1 Base Address
#define CCMSRAM_BASEADDR	0x10000000U	//CCMSRAM Base Address
#define ROM					0x1FFFD800U	//ROM Base Address
#define SRAM 				SRAM1BASEADDR

// step 2 define different buses in MCU
// Peripheral BUSES APB1-APB2-AHB1-AHB2-AHB3
#define  PERIPH_BASEADDR		0x40000000U
#define  APB1_BASEADDR			PERIPH_BASEADDR
#define  APB2_BASEADDR			0x40010000U
#define  AHB1_BASEADDR			0x40020000U
#define  AHB2_BASEADDR			0x48000000U
#define  AHB3_BASEADDR			0x50000000U
#define  AHB4_BASEADDR			0x60000000U

// step 3 define different GPIO peripheral in MCU
// Define AHB2 (GPIOx Peripheral)
#define GPIOA_BASEADDR			(AHB2_BASEADDR + 0x00000000U)
#define GPIOB_BASEADDR			(AHB2_BASEADDR + 0x0400U)
#define GPIOC_BASEADDR			(AHB2_BASEADDR + 0x800U)
#define GPIOD_BASEADDR			(AHB2_BASEADDR + 0x0C00U)
#define GPIOE_BASEADDR			(AHB2_BASEADDR + 0x1000U)
#define GPIOF_BASEADDR			(AHB2_BASEADDR + 0x1400U)
#define GPIOG_BASEADDR			(AHB2_BASEADDR + 0x1800U)
#define GPIOH_BASEADDR			(AHB2_BASEADDR + 0x1C00U)

// Define RCC
#define RCC_BASEADDR			(AHB1_BASEADDR + 0x1000)

// step 3
// Define  APB1 (I2Cx-SPIx-UARTx-USARTx)
#define I2C1_BASEADDR 			(APB1_BASEADDR + 0x5400U)
#define I2C2_BASEADDR 			(APB1_BASEADDR + 0x5800U)
#define I2C3_BASEADDR 			(APB1_BASEADDR + 0x7800U)
#define SPI2_BASEADDR 			(APB1_BASEADDR + 0x3800U)
#define SPI3_BASEADDR 			(APB1_BASEADDR + 0x3C00U)
#define USART2_BASEADDR 		(APB1_BASEADDR + 0x4400U)
#define USART3_BASEADDR 		(APB1_BASEADDR + 0x4800U)
#define UART4_BASEADDR 			(APB1_BASEADDR + 0x4C00U)
#define UART5_BASEADDR			(APB1_BASEADDR + 0x5000U)

// step 3
// Define APB2 (EXTI- SPIx-USARTx-SYSCFG)
#define EXTI_BASEADDR			(APB2_BASEADDR + 0x0400U)
#define SYSCFG_BASEADDR			(APB2_BASEADDR + 0x0000U)
#define SPI1_BASEADDR			(APB2_BASEADDR + 0x3000U)
#define SPI4_BASEADDR			(APB2_BASEADDR + 0x3C00U)
#define USART1_BASEADDR			(APB2_BASEADDR + 0x3800U)

// GPIOx register map and reset values
// step 4
// define structures of GPIO
typedef struct
{
	volatile uint32_t MODER;			//GPIO port mode register				//Address offset:0x00
	volatile uint32_t OTYPER;			//GPIO port output type register		//Address offset: 0x04
	volatile uint32_t OSPEEDR;			//GPIO port output speed register		//Address offset: 0x08
	volatile uint32_t PUPDR;			//GPIO port pull-up/pull-down register	//Address offset: 0x0C
	volatile uint32_t IDR;				//GPIO port input data register			//Address offset: 0x10
	volatile uint32_t ODR;				//GPIO port output data register		//Address offset: 0x14
	volatile uint32_t BSRR;				//GPIO port bit set/reset register		//Address offset: 0x18
	volatile uint32_t LCKR;				//GPIO port configuration lock register	//Address offset: 0x1C
	volatile uint32_t AFR[2];			//GPIO alternate function [0] low register	//Address offset: 0x20
										//GPIO alternate function [1] high register	//Address offset: 0x24
	volatile uint32_t BRR;				//GPIO port bit reset register			//Address offset: 0x28

}GPIO_RegDef_t;

#define GPIOA ( (GPIO_RegDef_t*) GPIOA_BASEADDR)
#define GPIOB ( (GPIO_RegDef_t*) GPIOB_BASEADDR)
#define GPIOC ( (GPIO_RegDef_t*) GPIOC_BASEADDR)
#define GPIOD ( (GPIO_RegDef_t*) GPIOD_BASEADDR)
#define GPIOE ( (GPIO_RegDef_t*) GPIOE_BASEADDR)
#define GPIOF ( (GPIO_RegDef_t*) GPIOF_BASEADDR)
#define GPIOG ( (GPIO_RegDef_t*) GPIOG_BASEADDR)
#define GPIOH ( (GPIO_RegDef_t*) GPIOH_BASEADDR)


// peripheral base Address of GPIOx typecastted to xxx_register


//RCC register map structure
//step 5
// define structure RCC
typedef struct
{
	volatile uint32_t CR;			//Clock control register				//Address offset: 0x00
	volatile uint32_t CFGR;			//Clock configuration register			//Address offset: 0x04
	volatile uint32_t CIR;			//Clock interrupt register (RCC_CIR)	//Address offset: 0x08
	volatile uint32_t APB2RSTR;		//APB2 peripheral reset register		//Address offset: 0x0C
	volatile uint32_t APB1RSTR;		//APB1 peripheral reset register		//Address offset: 0x10
	volatile uint32_t AHBENR;		//AHB peripheral clock enable register	//Address offset: 0x14
	volatile uint32_t APB2ENR;		//APB2 peripheral clock enable register	//Address: 0x18
	volatile uint32_t APB1ENR;		//APB1 peripheral clock enable register //Address: 0x1C
	volatile uint32_t BDCR;			//RTC domain control register			//Address offset: 0x20
	volatile uint32_t CSR;			//Control/status register				//Address: 0x24
	volatile uint32_t AHBRSTR;		//AHB peripheral reset register			//Address: 0x28
	volatile uint32_t CFGR2;		//Clock configuration register 2		//Address: 0x2C
	volatile uint32_t CFGR3;		//Clock configuration register 3		//Address: 0x30
}RCC_RegDef_t;

// step 4 define RCC very important
#define RCC 	((RCC_RegDef_t*)RCC_BASEADDR)
/*
 * peripheral register define structure of EXTI
 *
 */

typedef struct
{
	volatile uint32_t IMR1;				//Interrupt mask register  			// Address:0x00
	volatile uint32_t EMR1;				//Event mask register				// Address:0x04
	volatile uint32_t RTSR1;			//Rising trigger selection register // Address:0x08
	volatile uint32_t FTSR1;			//Falling trigger selection register// Address:0x0C
	volatile uint32_t SWIER1;			//Software interrupt event register // Address:0x10
	volatile uint32_t PR1;				//Pending register					// Address:0x14
}EXTI_RegDef_t;

#define EXTI	((EXTI_RegDef_t*)EXTI_BASEADDR)

typedef struct
{
	volatile uint32_t CFGR1;			// Address 0x00
	volatile uint32_t RCR;				// Address 0x04
	volatile uint32_t EXTICR[4];		// Address 0x08- 0x14
	volatile uint32_t CFGR2;			// Address 0x18
	volatile uint32_t CFGR3;			// Address 0x50
	volatile uint32_t CFGR4;			// Address 0x48

}SYSCFG_RegDef_t;

#define SYSCFG				((SYSCFG_RegDef_t*)SYSCFG_BASEADDR)
// step 6
// Enable / disable / Reset Peripherals
// Macro Function to enable GPIOX
#define GPIOA_PCLK_EN()			(RCC-> AHBENR |= (1<<17))		//Enable GPIOA
#define GPIOB_PCLK_EN()			(RCC-> AHBENR |= (1<<18))		//Enable GPIOB
#define GPIOC_PCLK_EN()			(RCC-> AHBENR |= (1<<19))		//Enable GPIOC
#define GPIOD_PCLK_EN()			(RCC-> AHBENR |= (1<<20))		//Enable GPIOD
#define GPIOE_PCLK_EN()			(RCC-> AHBENR |= (1<<21))		//Enable GPIOE
#define GPIOF_PCLK_EN()			(RCC-> AHBENR |= (1<<22))		//Enable GPIOF


// step 6
// Enable / disable / Reset Peripherals
// Macro Function to enable I2C

#define I2C1_PCLK_EN()			(RCC->APB1ENR |= (1<<21))		//Enable I2C1
#define I2C2_PCLK_EN()			(RCC->APB1ENR |= (1<<22))		//Enable I2C2
#define I2C3_PCLK_EN()			(RCC->APB1ENR |= (1<<30))		//Enable I2C3

// step 6
// Enable / disable / Reset Peripherals
// Macro Function to enable SPI
#define SPI1_PCLK_EN()			(RCC->APB2ENR |= (1<<12))		//Enable SPI1
#define SPI2_PCLK_EN()			(RCC->APB1ENR |= (1<<14))		//Enable SPI2
#define SPI3_PCLK_EN()			(RCC->APB1ENR |= (1<<15))		//Enable SPI3
#define SPI4_PCLK_EN()			(RCC->APB2ENR |= (1<<15))		//Enalbe SPI4

// step 6
// Enable / disable / Reset Peripherals
// Macro Function to enable USART
#define USART1_PCLK_EN()		(RCC->APB2ENR |= (1<<14))		//Enable USART1
#define USART2_PCLK_EN()		(RCC->APB1EN |= (1<<17))		//Enable USART2
#define USART3_PCLK_EN()		(RCC->APB1EN |= (1<<18))		//Enable USART3
#define USART4_PCLK_EN()		(RCC->APB1EN |= (1<<19))		//Enable USART4
#define USART5_PCLK_EN()		(RCC->APB1EN |= (1<<20))		//Enable USART5

// Macro Function to enable SYSCFG

#define SYSCFG_PCLK_EN()		(RCC->APB2ENR |=(1<<0))			//Enable SYSCFG

////////////////////////////////////////////////////////////////////////////////////////////////////////////

// step 6
// Enable / disable / Reset Peripherals
// Macro Function to disable GPIOX
#define GPIOA_PCLK_DI()			(RCC-> AHBENR &= ~(1<<17))		//Disable GPIOA
#define GPIOB_PCLK_DI()			(RCC-> AHBENR &= ~(1<<18))		//Disable GPIOB
#define GPIOC_PCLK_DI()			(RCC-> AHBENR &= ~(1<<19))		//Disable GPIOC
#define GPIOD_PCLK_DI()			(RCC-> AHBENR &= ~(1<<20))		//Disable GPIOD
#define GPIOE_PCLK_DI()			(RCC-> AHBENR &= ~(1<<21))		//Disable GPIOE
#define GPIOF_PCLK_DI()			(RCC-> AHBENR &= ~(1<<22))		//Disable GPIOF

// step 6
// Enable / disable / Reset Peripherals
// Macro Function to Reset GPIOX
#define GPIOA_REG_RESET()		do {(RCC-> AHBRSTR |= (1<<17)); (RCC-> AHBRSTR &= ~(1<<17));}while(0)
#define GPIOB_REG_RESET()		do {(RCC-> AHBRSTR |= (1<<18)); (RCC-> AHBRSTR &= ~(1<<17));}while(0)
#define GPIOC_REG_RESET()		do {(RCC-> AHBRSTR |= (1<<19)); (RCC-> AHBRSTR &= ~(1<<17));}while(0)
#define GPIOD_REG_RESET()		do {(RCC-> AHBRSTR |= (1<<20)); (RCC-> AHBRSTR &= ~(1<<17));}while(0)
#define GPIOE_REG_RESET()		do {(RCC-> AHBRSTR |= (1<<21)); (RCC-> AHBRSTR &= ~(1<<17));}while(0)
#define GPIOF_REG_RESET()		do {(RCC-> AHBRSTR |= (1<<22)); (RCC-> AHBRSTR &= ~(1<<17));}while(0)


// Reset SPI
#define SPI1_REG_RESET()		do {RCC->APB2ENR |= (1<<12); (RCC-> APB2ENR &= ~(1<<12));}while(0)
#define SPI2_REG_RESET()		do {RCC->APB1ENR |= (1<<14); (RCC-> APB1ENR &= ~(1<<14));}while(0)
#define SPI3_REG_RESET()		do {RCC->APB1ENR |= (1<<15); (RCC-> APB1ENR &= ~(1<<15));}while(0)
#define SPI4_REG_RESET()		do {RCC->APB2ENR |= (1<<15); (RCC-> APB2ENR &= ~(1<<15));}while(0)

// step 6
// Enable / disable / Reset Peripherals
// Macro Function to disable I2C

#define I2C1_PCLK_DI()			(RCC->APB1ENR &= ~(1<<21))		//Disable I2C1
#define I2C2_PCLK_DI()			(RCC->APB1ENR &= ~(1<<22))		//Disable I2C2
#define I2C3_PCLK_DI()			(RCC->APB1ENR &= ~(1<<30))		//Disable I2C3


// step 6
// Enable / disable / Reset Peripherals
// Macro Function to disable SPI
#define SPI1_PCLK_DI()			(RCC->APB2ENR &= ~(1<<12))		//Disable SPI1
#define SPI2_PCLK_DI()			(RCC->APB1ENR &= ~(1<<14))		//Disable SPI2
#define SPI3_PCLK_DI()			(RCC->APB1ENR &= ~(1<<15))		//Disable SPI3
#define SPI4_PCLK_DI()			(RCC->APB2ENR &= ~(1<<15))		//Disable SPI4



// step 6
// Enable / disable / Reset Peripherals
// Macro Function to enable USART
#define USART1_PCLK_DI()		(RCC->APB2ENR &= ~(1<<14))		//Disable USART1
#define USART2_PCLK_DI()		(RCC->APB1EN &= ~(1<<17))		//Disable USART2
#define USART3_PCLK_DI()		(RCC->APB1EN &= ~(1<<18))		//Disable USART3
#define USART4_PCLK_DI()		(RCC->APB1EN &= ~(1<<19))		//Disable USART4
#define USART5_PCLK_DI()		(RCC->APB1EN &= ~(1<<20))		//Disable USART5

// Macro Function to disable SYSCFG

#define SYSCFG_PCLK_DI()		(RCC->APB2ENR &= ~(1<<0))		//Disable SYSCFG

// Macro to GPIO_ BASEADDR_TO_CODE

#define GPIO_BASEADDR_TO_CODE(x)	     	((x == GPIOA)? 0 :(x == GPIOB)? 1 :(x == GPIOC)? 2 :(x == GPIOD)? 3 :(x == GPIOE)? 4 :(x == GPIOF)? 5 :0)


/*
 * Interrupt Request (IRQ) for stm32f303re
 */

#define IRQ_NO_EXTI0 					6
#define IRQ_NO_EXTI1					7
#define IRQ_NO_EXTI2					8
#define IRQ_NO_EXTI3					9
#define IRQ_NO_EXTI4					10
#define IRQ_NO_EXTI5_9					23
#define IRQ_NO_EXTI10_15				40

/*
 * Periorty number macro
 */

#define NVIC_IRQ_PERIO1					1
#define NVIC_IRQ_PERIO2					2
#define NVIC_IRQ_PERIO3					3
#define NVIC_IRQ_PERIO4					4
#define NVIC_IRQ_PERIO5					5
#define NVIC_IRQ_PERIO6					6
#define NVIC_IRQ_PERIO7					7
#define NVIC_IRQ_PERIO8					8
#define NVIC_IRQ_PERIO9					9
#define NVIC_IRQ_PERIO10				10
#define NVIC_IRQ_PERIO11				11
#define NVIC_IRQ_PERIO12				12
#define NVIC_IRQ_PERIO13				13
#define NVIC_IRQ_PERIO14				14
#define NVIC_IRQ_PERIO15				15
// General Macros

/*
 * IRQ for spi
 */

#define NVIC_IRQ_SPI1					35
#define NVIC_IRQ_SPI2					36
#define NVIC_IRQ_SPI3					51
#define NVIC_IRQ_SPI4					84


#define Enable 			1
#define Disable 		0
#define Set 			Enable
#define Reset			Disable
#define GPIO_PIN_SET	Set
#define GPIO_PIN_RESET	Reset
#define FLAG_RESET		Reset
#define FLAG_SET		Set

// Step 1 define SPI Register in Struct
typedef struct
{
	volatile uint32_t SPI_CR1;      //Control Register 1				offset 0x00
	volatile uint32_t SPI_CR2;		//Control Register 2				offset 0x04
	volatile uint32_t SPI_SR;		//Status Register       			offset 0x08
	volatile uint32_t SPI_DR;		//SPI data register     			offset 0x0C
	volatile uint32_t SPI_CRCPR;    //Polynomial Register   			offset 0x10
	volatile uint32_t SPI_RXCRCR;	//Rx CRC register	    			offset 0x14
	volatile uint32_t SPI_TXCRCR;	//SPI Tx CRC register				offset 0x18
	volatile uint32_t SPI_I2SCFGR;	//SPIx_I2S configuration register	offset 0x1C
	volatile uint32_t SPI_I2SPR;	//SPIx_I 2 S pre-scaler register  	offset 0x20

}SPI_RegDef_t;

#define SPI1 ( (SPI_RegDef_t*) SPI1_BASEADDR)
#define SPI2 ( (SPI_RegDef_t*) SPI2_BASEADDR)
#define SPI3 ( (SPI_RegDef_t*) SPI3_BASEADDR)
#define SPI4 ( (SPI_RegDef_t*) SPI4_BASEADDR)

/*
 * Bit position definition SPI_CR1
 */
#define SPI_CR1_CPHA		0
#define SPI_CR1_CPOL		1
#define SPI_CR1_MSTR		2
#define SPI_CR1_BR			3
#define SPI_CR1_SPE			6
#define SPI_CR1_LSB_FIRST	7
#define SPI_CR1_SSI			8
#define SPI_CR1_SSM			9
#define SPI_CR1_RX_ONLY		10
#define SPI_CR1_CRCL		11
#define SPI_CR1_CRC_NEXT	12
#define SPI_CR1_CRC_EN		13
#define SPI_CR1_BIDI_OE		14
#define SPI_CR1_BIDI_MODE	15

/*
 * Bit Position defination SPI_CR2
 */

#define SPI_CR2_RXDMAEN				0
#define SPI_CR2_TXDMAEN				1
#define SPI_CR2_SSOE				2
#define SPI_CR2_NSSP				3
#define SPI_CR2_FRF					4
#define SPI_CR2_ERRIE				5
#define SPI_CR2_RXNEIE				6
#define SPI_CR2_TXEIE				7
#define SPI_CR2_DS					8
#define SPI_CR2_FRXT				12
#define SPI_CR2_LDMA_RX				13
#define SPI_CR2_LDMA_TX				14

/*
 * Bit position defination SPI_Status_register
 */

#define SPI_SR_RXNE					0
#define SPI_SR_TXE					1
#define SPI_SR_CHSIDE				2
#define SPI_SR_UDR					3
#define SPI_SR_CRCERR				4
#define SPI_SR_MODF					5
#define SPI_SR_OVR					6
#define SPI_SR_BSY					7
#define SPI_SR_FRE					8
#define SPI_SR_FRLVL				9
#define SPI_SR_FTVL					11






// Steps for SPI_drivers in stm32f303re.h
/*
 * Define SPI_Base_Address;
 * Enable Clock for SPI;
 * Disable Clock for SPI;
 * Create Struct for SPI Register;
 *
 */

#include "stm32f303re_gpio_driver.h"
#include "stm32f303re_SPI_driver.h"
#endif /* INC_STM32F303RE_H_ */
